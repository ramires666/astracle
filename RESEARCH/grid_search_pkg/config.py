"""
Grid Search Configuration.

Contains GridSearchConfig class for hyperparameter search settings.
"""
from typing import Dict, List, Optional


class GridSearchConfig:
    """
    ═══════════════════════════════════════════════════════════════════════════════
    КОНФИГУРАЦИЯ GRID SEARCH (ПЕРЕБОР ПАРАМЕТРОВ)
    ═══════════════════════════════════════════════════════════════════════════════
    
    Grid Search — это метод поиска лучших параметров путём перебора всех комбинаций.
    Например, если у нас 3 значения orb и 3 значения gauss_std, мы проверим 3×3=9 комбинаций.
    
    ПАРАМЕТРЫ:
    ─────────────────────────────────────────────────────────────────────────────
    
    • orb_multipliers - множители орбиса аспектов
      [0.5] — узкие орбисы (только точные аспекты)
      [1.0] — стандартные орбисы
      [1.5] — широкие орбисы (больше аспектов)
      
    • gauss_windows - размер окна для сглаживания Гаусса (дней)
      [51]  — короткое окно (чувствительно к мелким движениям)
      [201] — длинное окно (ловит только большие тренды)
      
    • gauss_stds - стандартное отклонение Гаусса
      [30.0] — узкий колокол (чувствительная разметка)
      [70.0] — широкий колокол (плавная разметка)
      
    • coord_modes - системы координат для расчёта планет
      ["geo"]   — только геоцентрическая (Земля в центре, классика)
      ["helio"] — только гелиоцентрическая (Солнце в центре)
      ["both"]  — ОБЕ системы (удваивает количество признаков!)
      ["geo", "helio", "both"] — перебрать все три варианта
      
    • max_exclude - ABLATION: исключение астро-тел
      0 — не исключать тела (только orb/gauss/coord)
      1 — пробовать исключать по 1 телу
      2 — пробовать исключать до 2 тел
      4 — пробовать исключать до 4 тел
      
      Это КОМБИНАТОРНЫЙ взрыв! С 11 телами:
      - max_exclude=1: 11 вариантов
      - max_exclude=2: 66 вариантов
      - max_exclude=3: 231 вариант
      - max_exclude=4: 561 вариант
      
    • max_combos - ограничение количества комбинаций (для тестов)
    
    • model_params - параметры XGBoost модели
    ═══════════════════════════════════════════════════════════════════════════════
    """
    
    def __init__(
        self,
        orb_multipliers: List[float] = [0.8, 1.0, 1.2],
        gauss_windows: List[int] = [101, 151, 201],
        gauss_stds: List[float] = [30.0, 50.0, 70.0],
        coord_modes: List[str] = ["geo"],  # geo, helio, both
        max_exclude: int = 0,  # 0 = без ablation, 4 = исключать до 4 тел
        max_combos: Optional[int] = None,
        model_params: Optional[Dict] = None,
    ):
        # ─────────────────────────────────────────────────────────────────────────
        # Сохраняем все параметры
        # ─────────────────────────────────────────────────────────────────────────
        self.orb_multipliers = orb_multipliers
        self.gauss_windows = gauss_windows
        self.gauss_stds = gauss_stds
        self.coord_modes = coord_modes
        self.max_exclude = max_exclude
        self.max_combos = max_combos
        self.model_params = model_params or {
            "n_estimators": 500,    # Количество деревьев в ансамбле
            "max_depth": 3,         # Глубина каждого дерева (защита от переобучения)
            "learning_rate": 0.03,  # Скорость обучения (меньше = стабильнее)
            "subsample": 0.8,       # Доля данных для каждого дерева
            "colsample_bytree": 0.8,  # Доля признаков для каждого дерева
        }
